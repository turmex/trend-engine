{# ═══════════════════════════════════════════════════════════ #}
{# COMPETITOR INTELLIGENCE                                     #}
{# ═══════════════════════════════════════════════════════════ #}
{% if competitor_data and competitor_data.videos %}
<div style="padding:24px 28px;">
    <div style="font-size:11px;color:#6366f1;font-weight:700;text-transform:uppercase;letter-spacing:1.5px;">Competitor Intelligence</div>
    <h2 style="font-size:20px;font-weight:700;margin:6px 0 4px;color:#1e293b;">What Top Creators Covered This Week</h2>
    <p style="font-size:13px;color:#64748b;margin:0 0 16px;">Tracked {{ competitor_data.summary.total_channels_checked }} channels &middot; {{ competitor_data.summary.total_new_videos }} new videos &middot; {{ competitor_data.summary.relevant_videos }} relevant to your niche</p>

    {% if competitor_data.summary.top_topics %}
    <div style="background:#f0f9ff;border:1px solid #bae6fd;border-radius:8px;padding:12px 16px;margin-bottom:16px;">
        <div style="font-size:11px;font-weight:700;color:#0369a1;letter-spacing:0.3px;">HOT TOPICS ACROSS COMPETITORS:</div>
        <div style="font-size:13px;color:#0c4a6e;margin-top:6px;">
            {% for topic in competitor_data.summary.top_topics[:7] %}
            <span style="display:inline-block;background:#e0f2fe;border-radius:12px;padding:3px 10px;margin:2px 4px 2px 0;font-size:12px;">{{ topic }}</span>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    {% for category, videos in competitor_data.by_category.items() %}
    {% set relevant_videos = [] %}
    {% for v in videos %}
        {% if v.matched_keywords %}
            {% if relevant_videos.append(v) %}{% endif %}
        {% endif %}
    {% endfor %}

    {% if relevant_videos %}
    <div style="margin-bottom:16px;">
        <div style="font-size:12px;font-weight:700;color:#475569;text-transform:uppercase;letter-spacing:0.5px;margin-bottom:8px;border-bottom:1px solid #e2e8f0;padding-bottom:4px;">
            {{ category | replace('_', ' ') | title }}
        </div>
        {% for video in relevant_videos[:5] %}
        <div style="padding:8px 0;border-bottom:1px solid #f1f5f9;{% if loop.last %}border-bottom:none;{% endif %}">
            <div style="font-size:13px;font-weight:600;color:#1e293b;">
                <a href="{{ video.url }}" style="color:#1e293b;text-decoration:none;">{{ video.title }}</a>
            </div>
            <div style="font-size:11px;color:#94a3b8;margin-top:2px;">
                {{ video.channel }} &middot; {{ video.published[:10] if video.published|length > 10 else video.published }}
            </div>
            {% if video.matched_keywords %}
            <div style="margin-top:4px;">
                {% for kw in video.matched_keywords[:4] %}
                <span style="display:inline-block;background:#fef3c7;color:#92400e;border-radius:8px;padding:1px 8px;font-size:10px;margin-right:4px;">{{ kw }}</span>
                {% endfor %}
            </div>
            {% endif %}
            {% if video.transcript_snippet %}
            <div style="font-size:11px;color:#64748b;margin-top:4px;padding:6px 10px;background:#f8fafc;border-radius:4px;line-height:1.4;">
                <span style="font-weight:600;">Transcript:</span> "{{ video.transcript_snippet[:200] }}..."
            </div>
            {% endif %}
        </div>
        {% endfor %}
    </div>
    {% endif %}
    {% endfor %}

    {# Show non-relevant videos from competitors (what else they're covering) #}
    {% set other_videos = [] %}
    {% for v in competitor_data.videos %}
        {% if not v.matched_keywords %}
            {% if other_videos.append(v) %}{% endif %}
        {% endif %}
    {% endfor %}
    {% if other_videos %}
    <div style="background:#f8fafc;border-radius:8px;padding:12px 16px;margin-top:8px;">
        <div style="font-size:11px;font-weight:700;color:#64748b;letter-spacing:0.3px;margin-bottom:6px;">OTHER TOPICS COMPETITORS COVERED:</div>
        {% for video in other_videos[:6] %}
        <div style="font-size:12px;color:#475569;padding:3px 0;">
            <span style="color:#94a3b8;">{{ video.channel }}:</span> {{ video.title[:80] }}{% if video.title|length > 80 %}...{% endif %}
        </div>
        {% endfor %}
        {% if other_videos|length > 6 %}
        <div style="font-size:11px;color:#94a3b8;margin-top:4px;">+ {{ other_videos|length - 6 }} more non-overlapping videos</div>
        {% endif %}
    </div>
    {% endif %}
</div>
{% endif %}
