{# ════ ENGAGEMENT OPPORTUNITIES ════ #}
{% if engagement_opps %}
<div style="padding:24px;">
    <h2 style="font-size:17px;margin:0 0 4px;">Engagement Opportunities -- {{ engagement_opps | length }} Posts Worth Replying To</h2>
    <p style="font-size:12px;color:#6b7280;margin:0 0 12px;">People actively seeking help this week. A thoughtful reply from you builds trust and visibility. No pitch -- just help.</p>
    <table style="width:100%;border-collapse:collapse;font-size:13px;">
        <tbody>
        {% for opp in engagement_opps %}
        <tr><td style="padding:10px;border-bottom:1px solid #f0f0f0;">
            <div style="font-weight:600;color:#1e293b;">#{{ loop.index }}. <a href="{{ opp.url | default('#') }}" style="color:#2563eb;text-decoration:none;">{{ opp.title }}</a></div>
            <div style="font-size:12px;color:#6b7280;margin-top:2px;">{{ opp.subreddit | default('') }}{% if opp.score is not none %} &middot; &#9650;{{ opp.score }}{% endif %}{% if opp.num_comments is not none %} &middot; {{ opp.num_comments }} comments{% endif %}{% if opp.mentions %} &middot; Mentions: {{ opp.mentions | join(', ') }}{% endif %}</div>
            {% if opp.snippet %}
            <div style="font-size:12px;color:#4b5563;margin-top:4px;font-style:italic;">"{{ opp.snippet }}"</div>
            {% endif %}
            {# ── Suggested Reply callout ── #}
            {% if strategy is defined and strategy.engagement_replies is defined %}
            {% set reply_entry = none %}
            {# Match by position (reply[0] → opp[0]) or by title substring #}
            {% if loop.index0 < strategy.engagement_replies | length %}
                {% set reply_entry = strategy.engagement_replies[loop.index0] %}
            {% else %}
                {% for re in strategy.engagement_replies %}
                    {% if re.post_title in opp.title or opp.title in re.post_title %}
                        {% set reply_entry = re %}
                    {% endif %}
                {% endfor %}
            {% endif %}
            {% if reply_entry and reply_entry.suggested_reply %}
            <div style="background-color:#eff6ff;border-left:3px solid #3b82f6;padding:10px 14px;margin-top:8px;border-radius:0 4px 4px 0;">
                <div style="font-size:11px;font-weight:700;color:#1e40af;margin-bottom:4px;letter-spacing:0.3px;">SUGGESTED REPLY:</div>
                <div style="font-size:12px;color:#1e3a5f;font-style:italic;line-height:1.5;">{{ reply_entry.suggested_reply }}</div>
                <div style="font-size:10px;color:#6b7280;margin-top:6px;">Adapt to your voice. No pitch, no link &mdash; just help.</div>
            </div>
            {% endif %}
            {% endif %}
        </td></tr>
        {% endfor %}
        </tbody>
    </table>
</div>
{% endif %}
